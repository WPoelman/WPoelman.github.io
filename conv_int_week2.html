<!DOCTYPE html>
<html lang="nl-NL">

<head>
    <title>Wessel Poelman</title>
    <meta name="keywords" content="HTML" />
    <meta name="author" content="Wessel Poelman" />
    <meta name="description" content="Wessel Poelman" />
    <meta charset="UTF-8" />
    <link href="style/style.css" rel="stylesheet" />
</head>

<body>
    <div class="container">

        <header class="row">
            <div class="column col-8">
                <a href="index.html">
                    <h1>Wessel Poelman</h1>
                </a>
            </div>
        </header>

        <h2>Parrot Page</h2>
        <div class="row">
            <div class="column col-8">
                <div class="row">
                    <button id="start-button">Start listening</button>
                </div>
                <div class="row">
                    <div id="result" style="margin-top: 20px;">

                    </div>
                </div>
            </div>
            <div class="column col-4">
                <div class="row">
                    <label for="volume">Volume (0-1)</label>
                    <input type="number" name="volume" id="volume" value="1" min="0" max="1" />
                </div>
                <div class="row">

                    <label for="pitch">Pitch (0-2)</label>
                    <input type="number" name="pitch" id="pitch" value="1" min="0" max="2" />
                </div>
                <div class="row">

                    <label for="rate">Utterance speed (0-2)</label>
                    <input type="number" name="rate" id="rate" value="1" min="0" max="2" />
                </div>
            </div>
        </div>
    </div>
    </div>
    <script>
        const volume = document.getElementById('volume');
        const pitch = document.getElementById('pitch');
        const rate = document.getElementById('rate');

        const recognition = new webkitSpeechRecognition();
        const speech = new SpeechSynthesisUtterance();

        // These inputs are different between firefox and chrome, but since the
        // ASR only works on chrome, this is not a big issue here.
        volume.oninput = () => speech.volume = Number.parseFloat(volume.value);
        pitch.oninput = () => speech.pitch = Number.parseFloat(pitch.value);
        rate.oninput = () => speech.rate = Number.parseFloat(rate.value);

        recognition.continuous = false;
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 5;

        const result = document.getElementById('result');
        const startButton = document.getElementById('start-button');

        startButton.onclick = () => {
            recognition.start();
            result.textContent = 'Listening...';
        }

        recognition.onresult = (event) => {
            const bestResult = event.results[0][0].transcript;
            const bestResults = Object.values(event.results[0]).map((r) => r.transcript).join('<br/>');
            console.log('Result: ', bestResult);

            result.innerHTML = bestResults;

            speech.text = bestResult;
            window.speechSynthesis.speak(speech);
        }

        recognition.onspeechend = () => {
            recognition.stop();
            result.textContent = 'Not listening...';
        }

        recognition.onnomatch = (event) => {
            result.textContent = 'Not recognized';
        }

        recognition.onerror = (event) => {
            result.textContent = 'Error occurred in recognition: ' + event.error;
        }
    </script>
</body>

</html>